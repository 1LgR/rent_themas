{% extends "index.html" %} 
{% block content %}
    <div><p></p></div>
    <h3>Cadastro de Aluguel</h3>
    <hr>
        <form action="/saveRent/" method="post">
            {% csrf_token %}
            <div class="row mb-3">
                <label class="col-sm-1 col-form-label" for="rental-date">Data</label>
                <div class="col-sm-11">
                    <input type="date" id="rental-date" name="date">
                </div>
            </div> 

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label" for="start">Hora Início</label>
                <div class="col-sm-11">
                    <input id="start" type="time" name="start_hours">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="end">Hora Fim</label>
                <div class="col-sm-11">
                    <input id="end" type="time" name="end_hours">
                </div>
            </div>
            
            <div class="container">
                <div class="row mb-3">
                    <label class="col-sm-1 col-form-label" for="end">Tema</label>
                    <div class="col-sm-5">
                        <select class="form-select" name="select_theme" id="theme-select">
                            {% for theme in theme_list %}
                                {% if theme %}
                                    <option value="{{ theme.id }}" data-price="{{ theme.price }}">{{ theme.name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                        <h5>Preço:</h5><h6 id="theme-price"></h6>
                    </div>
                </div>
        
                <div class="row mb-3">
                    <label class="col-sm-1 col-form-label" for="client">Cliente</label>
                    <div class="col-sm-5">
                        <select class="form-select" name="select_client" id="client-select">
                            {% for client in client_list %}
                                {% if client %}
                                    <option value="{{ client.id }}" data-rentals="{{ client.rentals }}">{{ client.name }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>
        
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const themeSelect = document.getElementById('theme-select');
                    const clientSelect = document.getElementById('client-select');
                    const rentalDateInput = document.getElementById('rental-date');
                    const themePrice = document.getElementById('theme-price');
        
                    function updatePrice() {
                        const selectedTheme = themeSelect.options[themeSelect.selectedIndex];
                        const selectedClient = clientSelect.options[clientSelect.selectedIndex];
                        const rentalDate = new Date(rentalDateInput.value);
        
                        console.log('Selected Theme:', selectedTheme);
                        console.log('Selected Client:', selectedClient);
                        console.log('Rental Date:', rentalDate);
        
                        let price = parseFloat(selectedTheme.getAttribute('data-price')) || 0;
        
                        
                        if (parseInt(selectedClient.getAttribute('data-rentals')) >= 1) {
                            price *= 0.9;
                        }
        
                        
                        const dayOfWeek = rentalDate.getDay();
                        if (dayOfWeek >= 1 && dayOfWeek <= 3) {  
                            price *= 0.6;
                        }
        
                        themePrice.textContent = price ? `R$ ${price.toFixed(2)}` : 'N/A';
                    }
        
                    themeSelect.addEventListener('change', updatePrice);
                    clientSelect.addEventListener('change', updatePrice);
                    rentalDateInput.addEventListener('change', updatePrice);
        
                    
                    updatePrice();
                });
            </script>
            

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="street">Endereço</label>
                <div class="col-sm-11">
                    <input id="street" size="66" type="text" name="street">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="number">Número</label>
                <div class="col-sm-11">
                    <input id="number"  type="text" name="number">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="complement">Complemento</label>
                <div class="col-sm-11">
                    <input id="complement" size="66" type="text" name="complement">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="district">Bairro</label>
                <div class="col-sm-11">
                    <input id="district" size="66" type="text" name="district">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="city">Cidade</label>
                <div class="col-sm-11">
                    <input id="city" size="20" type="text" name="city">
                </div>
            </div>

            <div class="row mb-3">
                <label class="col-sm-1 col-form-label"  for="state">Estado</label>
                <div class="col-sm-11">
                    <input id="state" size="20" type="text" name="state">
                </div>
            </div>

            <hr>
            <a class="btn btn-secondary btn-sm" href="/listRent">Voltar</a>
            <input class="btn btn-primary" type="submit" value="Gravar">
        </form>
        
        
{% endblock %}